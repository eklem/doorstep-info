<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Justini - Just in time info display</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <script src="https://unpkg.com/vue@3.0.1/dist/vue.global.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/pure-min.css" integrity="sha384-cg6SkqEOCV1NbJoCu11+bm0NvBRc8IYLRGXkmNrqUBfTjmMYwNKPWBTIKyw9mHNJ" crossorigin="anonymous">
  <link rel="stylesheet" href="https://eklem.github.io/yr-icons/style.css">
  <link rel="stylesheet" href="./main.css">


</head>
<body>
  <div id="app" class="pure-g"></div>
    <script>
      const { createApp } = Vue

      const App = {
        data() {
          return {
            config: {
              lat: '59.90',
              lon: '10.79',
              alt: '49',
              timeZone: 1,
              dst: 1
            },
            weather: []
          }
        },
        methods: {
          getWeather(config) {
            let url = 'https://api.met.no/weatherapi/locationforecast/2.0/compact?lat=' + config.lat + '&lon=' + config.lon + '&altitude=' + config.alt
            fetch(url)
              .then(response => response.json())
              .then(data => {
                // set now array 
                let weather = data.properties.timeseries.slice(0, 13)
                this.weather = weather.map(function (item) {
                  // Calculate hour
                  const time = new Date(item.time)
                  let hour = time.getUTCHours() + config.timeZone + config.dst;
                  // pad short numbers
                  hour = hour.toString()
                  if (hour.length === 1) {
                    hour = '0' + hour
                  }
                  // return weather object
                  return {
                    hour: hour,
                    summary: 'yr-icon-' + item.data.next_1_hours.summary.symbol_code,
                    temperature: item.data.instant.details.air_temperature,
                    recipitation: item.data.next_1_hours.details.precipitation_amount,
                    windFromDirection: item.data.instant.details.wind_from_direction,
                    windSpeed: item.data.instant.details.wind_speed
                  }
                })
                // set forcast array
                console.log(JSON.stringify(data))
              })
          }
        },
        mounted: function() {
          this.getWeather(this.config)
        },
        template: `
          <div class="forecast pure-u-1-6" v-for="(item, index) in weather">
              <h2>{{ item.hour }}</h2>
              <span class="ico pure-img" :class="item.summary"></span>
              <div>{{ item.temperature }}Â°Cs</div>
              <div>{{ item.recipitation }} mms</div>
              <div>{{ item.windSpeed }} m/s</div>
          </div>
        `,
      }

      createApp(App).mount("#app")
    </script>

</body>
</html>