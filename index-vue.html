<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Justini - Just in time info display</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <script src="https://unpkg.com/vue@3.0.1/dist/vue.global.js"></script>
  <link rel="stylesheet" href="./node_modules/yr-icons/style.css">
</head>
<body>
  <div id="app"></div>
    <script>
      const { createApp } = Vue

      const App = {
        data() {
          return {
            config: {
              lat: '59.90',
              lon: '10.79',
              alt: '49',
              timeZone: 1,
              dst: 1
            },
            weather: []
          }
        },
        methods: {
          getWeather(config) {
            let url = 'https://api.met.no/weatherapi/locationforecast/2.0/compact?lat=' + config.lat + '&lon=' + config.lon + '&altitude=' + config.alt
            fetch(url)
              .then(response => response.json())
              .then(data => {
                // set now array 
                let weather = data.properties.timeseries.slice(0, 13)
                this.weather = weather.map(function (item) {
                  // Calculate hour
                  const time = new Date(item.time)
                  const hour = time.getUTCHours() + config.timeZone + config.dst;
                  // return weather object
                  return {
                    hour: hour,
                    summary: 'yr-icon-' + item.data.next_1_hours.summary.symbol_code,
                    temperature: item.data.instant.details.air_temperature,
                    windFromDirection: item.data.instant.details.wind_from_direction,
                    windSpeed: item.data.instant.details.wind_speed
                  }
                })
                // set forcast array
                console.log(JSON.stringify(data))
              })
          }
        },
        mounted: function() {
          this.getWeather(this.config)
        },
        template: `
          <div v-for="(item, index) in weather">
            <pre>
              Hour: {{ item.hour }}
              <span class="ico" :class="item.summary"></span>
              Temp: {{ item.temperature }} °C
              Wind from: {{ item.windFromDirection }}°
              Wind speed: {{ item.windSpeed }} m/s
            </pre>
          </div>
        `,
      }

      createApp(App).mount("#app")
    </script>

</body>
</html>